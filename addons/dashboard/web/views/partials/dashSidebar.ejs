<aside id="layout-menu" class="layout-menu menu-vertical menu glass-effect rounded-0">
    <div class="app-brand demo px-5">
        <a href="/dashboard/servers" class="app-brand-link">
            <span class="app-brand-logo demo">
                <span class="text-primary">
                    <img src="/assets/img/logo/logo.png" alt="kythia logo" width="40">
                </span>
            </span>
            <span class="app-brand-text demo menu-text fw-bold ms-2"> <img src="/assets/img/logo/logo-text.png" alt="kythia logo" width="120"></span>
        </a>

        <a href="javascript:void(0);" class="layout-menu-toggle menu-link glass-effect">
            <i class="fa-solid fa-chevron-left d-flex justify-content-center align-items-center"></i>
        </a>
    </div>
    <!-- <div class="menu-inner-shadow"></div> -->
    <ul class="menu-inner py-1 overflow-x-hidden">
        
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon icon-base fa-regular fa-server"></i>
                <div>Servers</div>
                <!-- <div class="badge text-bg-danger rounded-pill ms-auto"><%= guilds && Array.isArray(guilds) ? guilds.length : 0 %></div> -->
            </a>
            <ul class="menu-sub">
                <% 
                    var selectedServer = null;
                    if (guild && Array.isArray(guilds)) {
                        selectedServer = guilds.find(s => s.id == guild.id || s.id == guild);
                    }
                    if (Array.isArray(guilds) && guilds.length > 0) {
                        guilds.forEach(function(server) { 
                %>
                    <li class="menu-item<%= selectedServer && selectedServer.id === server.id ? ' active' : '' %>">
                        <% 
                            function getServerIconUrl(server) {
                                if (server.icon) {
                                    return `https://cdn.discordapp.com/icons/${server.id}/${server.icon}.png?size=32`;
                                } else {
                                    // Using the "fa-solid fa-server" as icon placeholder (font awesome) when missing
                                    return null;
                                }
                            }
                            var iconUrl = getServerIconUrl(server);

                            function shortServerName(name) {
                                if (!name) return '';
                                return name.length > 12 ? name.substring(0, 12) + 'â€¦' : name;
                            }
                        %>
                        <% if (server.hasBot) { %>
                            <a href="/dashboard/<%= server.id %>" class="menu-link d-flex align-items-center">
                                <% if (iconUrl) { %>
                                    <img src="<%= iconUrl %>"
                                         alt="<%= server.name %>"
                                         class="rounded-circle me-2"
                                         width="24" height="24"
                                         style="object-fit:cover;">
                                <% } else { %>
                                    <span class="d-flex align-items-center justify-content-center rounded-circle bg-secondary text-white me-2"
                                          style="width:24px; height:24px;">
                                        <i class="fa-solid fa-server"></i>
                                    </span>
                                <% } %>
                                <span><%= shortServerName(server.name) %></span>
                            </a>
                        <% } else { %>
                            <a href="https://discord.com/oauth2/authorize?client_id=<%= botClientId %>&scope=bot+applications.commands&permissions=<%= botPermissions %>&guild_id=<%= server.id %>&disable_guild_select=true" 
                               class="menu-link d-flex align-items-center text-warning" target="_blank" rel="noopener">
                                <% if (iconUrl) { %>
                                    <img src="<%= iconUrl %>"
                                         alt="<%= server.name %>"
                                         class="rounded-circle me-2"
                                         width="24" height="24"
                                         style="object-fit:cover;">
                                <% } else { %>
                                    <span class="d-flex align-items-center justify-content-center rounded-circle bg-secondary text-white me-2"
                                          style="width:24px; height:24px;">
                                        <i class="fa-solid fa-server"></i>
                                    </span>
                                <% } %>
                                <span><%= shortServerName(server.name) %></span>
                            </a>
                        <% } %>
                    </li>
                <% 
                        });
                    } else { 
                %>
                    <li class="menu-item">
                        <span class="menu-link text-muted">No servers found</span>
                    </li>
                <% } %>
            </ul>
        </li>
        <%
            if (guildId) { %>
        <li class="menu-header small">
            <span class="menu-header-text">Menus</span>
        </li>
        <li class="menu-item <%= currentPage == '/dashboard' ? 'active' : ''  %>">
            <a href="/dashboard/<%= guildId %>" class="menu-link">
                <i class="menu-icon icon-base fa-solid fa-chart-line"></i>
                <div>Dashboard</div>
            </a>
        </li>

        <li class="menu-item mt-2 <%= currentPage.startsWith('/dashboard/settings') ? 'active open' : '' %>">
            <a href="javascript:void(0);" class="menu-link menu-toggle <%= currentPage.startsWith('/dashboard/settings') ? 'active' : '' %>">
                <i class="menu-icon icon-base fa-regular fa-gears"></i>
                <div>Settings</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item <%= currentPage == '/dashboard/settings' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings" class="menu-link <%= currentPage == '/dashboard/settings' ? 'active' : '' %>">
                        <i class="fa fa-cog me-2"></i>
                        <div>Overview</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/features' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/features" class="menu-link <%= currentPage == '/dashboard/settings/features' ? 'active' : '' %>">
                        <i class="fa fa-toggle-on me-2"></i>
                        <div>Feature Toggle</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/automod' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/automod" class="menu-link <%= currentPage == '/dashboard/settings/automod' ? 'active' : '' %>">
                        <i class="fa fa-shield-alt me-2"></i>
                        <div>Automod</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/stats' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/stats" class="menu-link <%= currentPage == '/dashboard/settings/stats' ? 'active' : '' %>">
                        <i class="fa fa-chart-line me-2"></i>
                        <div>Server Stats</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/welcome' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/welcome" class="menu-link <%= currentPage == '/dashboard/settings/welcome' ? 'active' : '' %>">
                        <i class="fa fa-hand-wave me-2"></i>
                        <div>Welcome System</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/leveling' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/leveling" class="menu-link <%= currentPage == '/dashboard/settings/leveling' ? 'active' : '' %>">
                        <i class="fa fa-trophy me-2"></i>
                        <div>Leveling System</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/minecraft' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/minecraft" class="menu-link <%= currentPage == '/dashboard/settings/minecraft' ? 'active' : '' %>">
                        <i class="fa fa-cube me-2"></i>
                        <div>Minecraft</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/language' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/language" class="menu-link <%= currentPage == '/dashboard/settings/language' ? 'active' : '' %>">
                        <i class="fa fa-language me-2"></i>
                        <div>Language</div>
                    </a>
                </li>
                <!-- <li class="menu-item <%= currentPage == '/dashboard/settings/testimony' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/testimony" class="menu-link <%= currentPage == '/dashboard/settings/testimony' ? 'active' : '' %>">
                        <i class="fa fa-comment-dots me-2"></i>
                        <div>Testimony</div>
                    </a>
                </li> -->
                <li class="menu-item <%= currentPage == '/dashboard/settings/ai' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/ai" class="menu-link <%= currentPage == '/dashboard/settings/ai' ? 'active' : '' %>">
                        <i class="fa fa-robot me-2"></i>
                        <div>AI Features</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/streak' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/streak" class="menu-link <%= currentPage == '/dashboard/settings/streak' ? 'active' : '' %>">
                        <i class="fa fa-fire me-2"></i>
                        <div>Streak System</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/channels' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/channels" class="menu-link <%= currentPage == '/dashboard/settings/channels' ? 'active' : '' %>">
                        <i class="fa fa-hashtag me-2"></i>
                        <div>Channels</div>
                    </a>
                </li>
                <li class="menu-item <%= currentPage == '/dashboard/settings/booster' ? 'active' : '' %>">
                    <a href="/dashboard/<%= guildId %>/settings/booster" class="menu-link <%= currentPage == '/dashboard/settings/booster' ? 'active' : '' %>">
                        <i class="fa fa-rocket me-2"></i>
                        <div>Booster</div>
                    </a>
                </li>
            </ul>
        </li>
        <% } %>
    </ul>
</aside>